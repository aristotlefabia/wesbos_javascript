<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
</head>
<body>
    <style>
        .red {
            margin: 5rem;
            background: red;
            padding: 5rem;
            width: 5rem;
        }

            .red.green {
                margin: 5rem;
                background: green;
                padding: 5rem;
                width: 5rem;
            }

                .red.green.blue {
                    margin: 5rem;
                    background: blue;
                    padding: 5rem;
                    width: 5rem;
                }
    </style>
    <div class="red">
        Click Here
    </div>

    <script>
     const go = document.querySelector('.red');

        function makePizza(toppings) {
        return new Promise(function (resolve, reject) {

            if (toppings === '') {
                reject('unknown topping');
            }

            setTimeout(function () {
                resolve(`Here is pizza with ${toppings}`);
            }, 1000);


        });
    }


     function wait(ms=0) {
         return new Promise(function (resolve, reject) {
              console.log(`time ${ms}`);
             setTimeout(function () {
                 console.log(`done ${ms}`);

                 if (ms % 2 == 1) resolve(`done ${ms}`);
                 else reject(`invalid time`);
             }, ms);
                  //setTimeout(resolve, ms);
           
         });
     }
        function errHandler1(err) {
            s = new Date().getTime();
            for (let i = 0; i < 100000000; i++) {
            }

            e = new Date().getTime();
            console.log(`error1 : ${err} ${s} - ${e}`);
        }

        function errHandler2(err) {
            s = new Date().getTime();
            for (let i = 0; i < 100000000; i++) {
            }

            e = new Date().getTime();
            console.log(`error2 : ${err} ${s} - ${e}`);
        }


        //await - 1
        async function sequence1() {

                 await wait(10)
                .then(function (resolve) { console.log(resolve);})
                .catch(errHandler1);

        }
        console.log(sequence1());
        //await - 2
        async function sequence2() {

            await wait(10)
                .then(function (resolve) { console.log(resolve); })
        }

        sequence2().catch(errHandler2);



        //await - 1
        async function asynchronous1() {
                 wait(10)
                .then(function (resolve) { console.log(resolve);})
                .catch(errHandler1);

        }
        console.log(asynchronous1());

         async function asynchronous2() {
                 wait(10)
                .then(function (resolve) { console.log(resolve);})
  
        }

        asynchronous2().catch(errHandler2);


        



        async function run() {
            let n = 10000;

            //#2-a non error
            //wait(100).then(function (r) { console.log(`ok ${r}`); });
            //#1 then/catch together
            //wait(11)
            //    .then(function (r) { console.log(`ok2 ${r}`); })
            //    .catch (errHandler2);
            //wait(50).then(function (r) {console.log(`ok ${r}`); });
            //console.log('---------------------');


          
            //await wait(10).catch(errHandler);;
            //await wait(1).catch(errHandler);;

            //console.log('continues');

            //console.log('start');
            //await wait(2000);
            //console.log('end');
            //await wait(50);
            //console.log('end');
            //await wait(20);
            //console.log('end');
        }

        //run();
        //#2-b with error, handled in invocation
        run().catch(errHandler1);

        ////#3HO function
        //function makeSafe(fn, errHandler) {
        //    return function () {
        //        fn().catch(errHandler);
        //    }
        //}

        //makeSafe(run, errHandler1)();
     //go.addEventListener('click', function (e) {
     //   const target = e.currentTarget;
     //    wait(1000)
     //        .then(function (e) {
     //            target.classList.add('green');
     //            return wait(1000);
     //        })
     //        .then(function (e) {
     //           target.classList.add('blue');
     //            return wait(1000);
     //        })
     //        .then(function (e) {
     //          target.classList.remove('blue');
     //        });
        // new Promise(function (resolve, reject) {
        //     setTimeout(function () {
        //         target.classList.add('green');
        //         resolve(`1`);
        //     }, 1000);
        // })
        //     .then(function (e) {
        //        console.log(e);
        //        return new Promise(function (resolve, reject) {
        //            setTimeout(function (e) {
        //                target.classList.add('blue');
        //                resolve(`2`);
        //            }, 1000);
        //        });
        //    })
        //.then(function (e) {
        //    target.classList.remove('blue');
        //});

     //    setTimeout(function () {
     //        target.classList.add('green');
     //        setTimeout(function () {
     //            target.classList.add('blue');

     //            setTimeout(function () {
     //                 target.classList.remove('blue');
     //               }, 1000);
     //        }, 1000);

     //    }, 1000);

     //});



    </script>

</body>
</html>